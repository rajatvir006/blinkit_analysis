{% extends "base.html" %}
{% block title %}Login | Blinkit Retail Forecast{% endblock %}

{% block extra_css %}
<style>
  /* Hide top navbar on login page */
  .topbar {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    opacity: 0 !important;
  }

  /* Background section */
  .hero-section {
    position: relative;
    background-size: cover;
    background-position: center;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    overflow: hidden;
  }

  /* Dark overlay */
  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.55);
    z-index: 0;
  }

 
  .hero-text {
    position: absolute;
    top: 6%;
    left: 3%;
    text-align: left;
    color: #ffffff;
    z-index: 2;
  }

  .hero-text .app-title {
    font-family: 'Josefin Sans', sans-serif;
    font-size: 3rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: #ffffff;
  }

  .hero-text .it-text {
    color: #00b300;
  }

  .hero-text .subtitle {
    font-size: 1rem;
    font-weight: 500;
    color: #e6e6e6;
    font-family: 'Lato', sans-serif;
    margin-top: 0.4rem;
  }

  /* Login card */
  .login-card {
    position: relative;
    z-index: 3;
    background: rgba(255, 255, 255, 0.97);
    border-radius: 16px;
    padding: 2.8rem 2.5rem;
    max-width: 740px;
    width: 90%;
    margin-top: 6rem;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    backdrop-filter: blur(8px);
  }

  .login-card h2 {
    text-align: center;
    font-family: 'Josefin Sans', sans-serif;
    margin-bottom: 0.5rem;
  }

  .login-card p.muted {
    text-align: center;
    color: #666;
    margin-bottom: 2rem;
  }

  .login-container {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    justify-content: space-around;
  }

  .login-box,
  .signup-box {
    flex: 1 1 320px;
  }

  label {
    display: block;
    font-weight: 600;
    margin-top: 1rem;
  }

  input {
    width: 100%;
    padding: 0.6rem 0.8rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-top: 0.3rem;
    font-size: 0.95rem;
  }

  .btn-primary.full,
  .btn-outline.full {
    width: 100%;
    margin-top: 1rem;
  }

  .text-center {
    text-align: center;
  }

  .small {
    font-size: 0.9rem;
  }

  .muted a {
    color: #00b300;
  }

  @media (max-width: 768px) {
    .hero-text {
      top: 5%;
      left: 6%;
      font-size: 2rem;
    }
    .login-card {
      padding: 2rem 1.5rem;
      margin-top: 5rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<section class="hero-section" style="background-image: url('https://images.unsplash.com/photo-1604719312566-8912e9227c6a?auto=format&fit=crop&w=1600&q=80');">
  <div class="hero-overlay"></div>

  <!-- Blinkit text -->
  <div class="hero-text">
    <h1 class="app-title">blink<span class="it-text">it</span></h1>
    <p class="subtitle">Retail Sales Forecasting & Analytics</p>
  </div>

  <!-- LOGIN CARD -->
  <div class="login-card">
    <h2>Welcome</h2>
    <p class="muted">Sign in to access forecasting and analytics.</p>

    <div class="login-container">
      <!-- Login Form -->
      <div class="login-box">
        <h3>Log In</h3>
        <label>Email</label>
        <input type="email" id="login-email" placeholder="you@example.com" required>
        <label>Password</label>
        <input type="password" id="login-password" placeholder="********" required>
        <button type="button" class="btn-primary full" id="login-btn">Log in</button>
      </div>

      <!-- Signup Form -->
      <div class="signup-box">
        <h3>Create Account</h3>
        <label>Email</label>
        <input type="email" id="signup-email" placeholder="you@example.com" required>
        <label>Password <span class="muted small">(min 6 chars)</span></label>
        <input type="password" id="signup-password" placeholder="********" required>
        <button type="button" class="btn-outline full" id="signup-btn">Create Account</button>
      </div>
    </div>

    <p class="muted small text-center">
      Just viewing? <a href="{{ url_for('guest_login') }}" id="guest-link">Continue as guest</a>
    </p>
  </div>
</section>

<!-- Firebase Auth Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBaFAQkOTUWkOP3R8U03WK19-nvt35yMLA",
    authDomain: "blinkit-sales-forecast.firebaseapp.com",
    projectId: "blinkit-sales-forecast",
    storageBucket: "blinkit-sales-forecast.firebasestorage.app",
    messagingSenderId: "434379532982",
    appId: "1:434379532982:web:0e70d452c62ceeb36d1417",
    measurementId: "G-CTNX36TXYN"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  document.getElementById("login-btn").addEventListener("click", async () => {
    const email = document.getElementById("login-email").value.trim();
    const password = document.getElementById("login-password").value.trim();
    if (!email || !password) return alert("Please fill in both fields.");
    try {
      const cred = await signInWithEmailAndPassword(auth, email, password);
      await fetch("/set-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: cred.user.email })
      });
      window.location.href = "{{ url_for('home') }}";
    } catch (err) {
      alert("Login failed. Check your credentials.");
      console.error(err);
    }
  });

  document.getElementById("signup-btn").addEventListener("click", async () => {
    const email = document.getElementById("signup-email").value.trim();
    const password = document.getElementById("signup-password").value.trim();
    if (!email || !password) return alert("Please fill in both fields.");
    if (password.length < 6) return alert("Password must be at least 6 characters.");
    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      await fetch("/set-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: cred.user.email })
      });
      alert("Account created successfully!");
      window.location.href = "{{ url_for('home') }}";
    } catch (err) {
      alert("Signup failed. Try a different email or stronger password.");
      console.error(err);
    }
  });
</script>
{% endblock %}
